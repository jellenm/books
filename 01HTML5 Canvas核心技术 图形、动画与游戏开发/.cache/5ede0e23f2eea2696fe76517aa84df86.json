{"dependencies":[],"generated":{"js":"const WIDTH = 1000,HEIGHT = 300;\r\nlet canvas = document.getElementById('canvas'),\r\n\tcontext = canvas.getContext('2d');\r\nlet copycanvas = document.createElement('canvas'),\r\n\tcopycontext = copycanvas.getContext('2d');\r\nlet imageData,\r\n\tmousedownFlag,\r\n\tmousedownPos={},\r\n\tscale = 3;\r\ncanvas.width = WIDTH;\r\ncanvas.height = HEIGHT;\r\ncopycanvas.width = WIDTH*scale;\r\ncopycanvas.height = HEIGHT*scale;\r\n\r\nlet Glass = function(pos,radius){\r\n\tthis.x = pos.x;\r\n\tthis.y = pos.y;\r\n\tthis.radius = radius;\r\n}\r\nGlass.prototype = {\r\n\tdraw(context,pos) {\r\n\t\tcontext.clearRect(0,0,WIDTH,HEIGHT);\r\n\t\t// context.drawImage(image,0,0,image.width,image.height,0,0,WIDTH,HEIGHT);\r\n\t\tcontext.putImageData(imageData,0,0,0,0,WIDTH,HEIGHT);\r\n\t\tcontext.save();\r\n\t\tcontext.beginPath();\r\n\t\tif(pos){\r\n\t\t\tthis.x = pos.x;\r\n\t\t\tthis.y = pos.y;\r\n\t\t}\r\n\t\tcontext.arc(this.x,this.y,this.radius,0,2*Math.PI,false);\r\n\t\tcontext.fillStyle = '#000000';\r\n\t\tcontext.stroke();\r\n\t\tcontext.clip();\r\n\t\tcontext.drawImage(copycanvas,(scale-1)*pos.x,(scale-1)*pos.y,WIDTH,HEIGHT,0,0,WIDTH,HEIGHT);\r\n\t\tcontext.restore();\r\n\t}\r\n}\r\n\r\nlet glass = new Glass({x:600,y:100},100);\r\nlet image = new Image();\r\nimage.src = './detail.jpg';\r\nimage.onload = function(){\r\n\tcontext.drawImage(image,0,0,image.width,image.height,0,0,WIDTH,HEIGHT);\r\n\timageData = context.getImageData(0,0,WIDTH,HEIGHT);\r\n\tconsole.log('iamgeData',imageData)\r\n\tcopycontext.drawImage(image,0,0,image.width,image.height,0,0,WIDTH*scale,HEIGHT*scale);\r\n\tglass.draw(context,{x:300,y:100});\r\n}\r\n\r\nfunction posToCanvas(pos){\r\n\tlet canvasPos = canvas.getBoundingClientRect(),x,y;\r\n\tx = pos.x - canvasPos.left;\r\n\ty = pos.y - canvasPos.top;\r\n\treturn {x,y}\r\n}\r\nfunction mousedownEve(e){\r\n\tif(e.target.tagName == 'CANVAS'){\r\n\t\tmousedownFlag = true;\r\n\t\tmousedownPos = posToCanvas({x:e.pageX,y:e.pageY});\r\n\t\tglass.draw(context,mousedownPos);\r\n\t}\r\n}\r\nfunction mousemoveEve(e){\r\n\tif(mousedownFlag){\r\n\t\tglass.draw(context,posToCanvas({x:e.pageX,y:e.pageY}));\r\n\t}\r\n}\r\nfunction mouseupEve(e){\r\n\tif(mousedownFlag){\r\n\t\tmousedownFlag =false;\r\n\t}\r\n}\r\ndocument.addEventListener('mousedown',mousedownEve,false);\r\ndocument.addEventListener('mousemove',mousemoveEve,false);\r\ndocument.addEventListener('mouseup',mouseupEve,false);"},"hash":"1d03f12f1589308898ab326b0e1c16ed"}